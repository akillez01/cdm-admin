<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Corre√ß√£o Espec√≠fica - CDM Admin</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .fix-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4caf50;
        }
        .problem-card {
            background: rgba(255,152,0,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        .command {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 14px;
            border-left: 4px solid #2196f3;
        }
        .btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: rgba(76,175,80,0.2); border-left: 4px solid #4caf50; }
        .error { background: rgba(244,67,54,0.2); border-left: 4px solid #f44336; }
        .warning { background: rgba(255,152,0,0.2); border-left: 4px solid #ff9800; }
        .checklist {
            background: rgba(33,150,243,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .checklist h4 {
            margin-top: 0;
            color: #2196f3;
        }
        .checklist-item {
            margin: 8px 0;
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Corre√ß√£o Espec√≠fica CDM Admin</h1>
            <p>Solu√ß√µes r√°pidas para problemas comuns ap√≥s deploy no Plesk</p>
        </div>

        <div class="problem-card">
            <h3>‚ùå Problema: Logo n√£o aparece</h3>
            <p><strong>Causa comum:</strong> Problemas de permiss√£o ou caminho incorreto</p>
            
            <div class="checklist">
                <h4>‚úÖ Checklist de Corre√ß√£o:</h4>
                <div class="checklist-item">1. Verificar se o arquivo existe</div>
                <div class="checklist-item">2. Verificar permiss√µes do arquivo</div>
                <div class="checklist-item">3. Verificar permiss√µes do diret√≥rio</div>
                <div class="checklist-item">4. Testar acesso direto</div>
            </div>

            <button class="btn" onclick="testLogoFix()">üîç Testar Corre√ß√£o da Logo</button>
        </div>

        <div class="fix-card">
            <h3>üîß Corre√ß√£o 1: Permiss√µes de Arquivo</h3>
            <p>Execute no terminal SSH do Plesk:</p>
            <div class="command">
# Ir para o diret√≥rio do projeto
cd /var/www/vhosts/seu-dominio.com/httpdocs/cdm-admin

# Corrigir permiss√µes do diret√≥rio images
chmod 755 images/

# Corrigir permiss√µes da logo
chmod 644 images/cdmlogo.png

# Verificar se o arquivo existe
ls -la images/cdmlogo.png</div>
        </div>

        <div class="fix-card">
            <h3>üîß Corre√ß√£o 2: Verifica√ß√£o de Caminho</h3>
            <p>Teste direto no navegador:</p>
            <div class="command">https://seu-dominio.plesk.page/cdm-admin/images/cdmlogo.png</div>
            <p>Se n√£o funcionar, verifique se o arquivo foi enviado corretamente.</p>
        </div>

        <div class="fix-card">
            <h3>üîß Corre√ß√£o 3: Problemas de CSP</h3>
            <p>Se o console do navegador mostrar erros de CSP, verifique se o index.html cont√©m:</p>
            <div class="command">img-src 'self' data: https://*;</div>
            <button class="btn" onclick="testCSP()">üõ°Ô∏è Testar CSP</button>
        </div>

        <div class="problem-card">
            <h3>‚ùå Problema: Dados n√£o carregam do Supabase</h3>
            <p><strong>Causa comum:</strong> CORS, CSP ou chaves incorretas</p>
            
            <div class="checklist">
                <h4>‚úÖ Checklist de Corre√ß√£o:</h4>
                <div class="checklist-item">1. Verificar chaves do Supabase</div>
                <div class="checklist-item">2. Verificar CORS no Supabase</div>
                <div class="checklist-item">3. Verificar CSP</div>
                <div class="checklist-item">4. Verificar conectividade</div>
            </div>

            <button class="btn" onclick="testSupabaseFix()">üîó Testar Corre√ß√£o Supabase</button>
        </div>

        <div class="fix-card">
            <h3>üîß Corre√ß√£o 4: Configura√ß√£o Supabase</h3>
            <p>1. V√° para <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a></p>
            <p>2. Em Authentication > URL Configuration, adicione:</p>
            <div class="command">https://seu-dominio.plesk.page/cdm-admin</div>
            <p>3. Verifique se as chaves est√£o corretas no arquivo .env</p>
        </div>

        <div class="fix-card">
            <h3>üîß Corre√ß√£o 5: Rebuild e Redeploy</h3>
            <p>Se nada funcionar, fa√ßa um rebuild completo:</p>
            <div class="command">
# No seu ambiente local
npm run build

# Recriar o ZIP de deploy
cd deploy-plesk
zip -r ../cdm-admin-fix.zip .

# Fazer upload do novo ZIP</div>
        </div>

        <div id="test-results" style="margin-top: 30px;"></div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="runAllFixes()">üöÄ Executar Todas as Corre√ß√µes</button>
            <button class="btn" onclick="location.href='./diagnostico-especifico.html'">üîç Diagn√≥stico Completo</button>
        </div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const statusClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            resultsDiv.innerHTML += `<div class="status ${statusClass}">${message}</div>`;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        async function testLogoFix() {
            clearResults();
            showResult('üîç Testando corre√ß√£o da logo...', 'info');

            const logoPaths = [
                './images/cdmlogo.png',
                '/cdm-admin/images/cdmlogo.png',
                'images/cdmlogo.png'
            ];

            let logoFound = false;
            for (const path of logoPaths) {
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        showResult(`‚úÖ Logo encontrada em: ${path}`, 'success');
                        logoFound = true;
                        break;
                    }
                } catch (error) {
                    console.log(`Erro ao testar ${path}:`, error);
                }
            }

            if (!logoFound) {
                showResult('‚ùå Logo n√£o encontrada em nenhum caminho', 'error');
                showResult('üí° Verifique se o arquivo foi enviado corretamente', 'warning');
                showResult('üí° Execute: chmod 644 images/cdmlogo.png', 'warning');
            }
        }

        async function testCSP() {
            clearResults();
            showResult('üõ°Ô∏è Testando CSP...', 'info');

            // Verificar se h√° meta CSP na p√°gina
            const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (cspMeta) {
                const content = cspMeta.getAttribute('content');
                if (content.includes('img-src')) {
                    showResult('‚úÖ CSP configurada para imagens', 'success');
                } else {
                    showResult('‚ùå CSP n√£o permite imagens adequadamente', 'error');
                }
                
                if (content.includes('supabase.co')) {
                    showResult('‚úÖ CSP permite Supabase', 'success');
                } else {
                    showResult('‚ùå CSP n√£o permite Supabase', 'error');
                }
            } else {
                showResult('‚ö†Ô∏è CSP n√£o encontrada', 'warning');
            }
        }

        async function testSupabaseFix() {
            clearResults();
            showResult('üîó Testando corre√ß√£o Supabase...', 'info');

            const supabaseUrl = 'https://xkkbeilbthmezeqizcch.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhra2JlaWxidGhtZXplcWl6Y2NoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI1ODMyMjAsImV4cCI6MjA0ODE1OTIyMH0.xdMf9lAdICW2xzpUwzZJQJIc6iGqsNL7gRcjE9fSMnU';

            try {
                const response = await fetch(`${supabaseUrl}/rest/v1/`, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`
                    }
                });

                if (response.ok) {
                    showResult('‚úÖ Supabase conectado com sucesso', 'success');
                    
                    // Testar tabela espec√≠fica
                    const tableTest = await fetch(`${supabaseUrl}/rest/v1/inventory_items?limit=1`, {
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`
                        }
                    });

                    if (tableTest.ok) {
                        showResult('‚úÖ Tabela inventory_items acess√≠vel', 'success');
                    } else {
                        showResult('‚ùå Tabela inventory_items n√£o acess√≠vel', 'error');
                    }
                } else {
                    showResult(`‚ùå Erro de conectividade Supabase: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Erro de rede Supabase: ${error.message}`, 'error');
                showResult('üí° Verifique CORS no dashboard do Supabase', 'warning');
            }
        }

        async function runAllFixes() {
            clearResults();
            showResult('üöÄ Executando todas as corre√ß√µes...', 'info');
            
            await testLogoFix();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testCSP();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testSupabaseFix();
            
            showResult('‚úÖ Todas as corre√ß√µes testadas!', 'success');
            showResult('üìã Revise os resultados acima para identificar problemas espec√≠ficos', 'info');
        }

        // Auto-executar teste b√°sico na carga
        window.addEventListener('load', () => {
            setTimeout(() => {
                showResult('üîß P√°gina de corre√ß√£o carregada. Clique nos bot√µes para testar corre√ß√µes espec√≠ficas.', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
